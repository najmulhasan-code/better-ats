generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id          String   @id @default(uuid())
  email       String   @unique
  name        String?
  avatarUrl   String?  @map("avatar_url")
  companySlug String   @map("company_slug")
  role        String   @default("recruiter")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  company     Company  @relation(fields: [companySlug], references: [slug], onDelete: Cascade)

  @@index([companySlug])
  @@index([email])
  @@map("users")
}

model Company {
  id          String      @id @default(uuid())
  slug        String      @unique
  name        String
  description String?
  website     String?
  createdAt   DateTime    @default(now()) @map("created_at")
  updatedAt   DateTime    @updatedAt @map("updated_at")
  candidates  Candidate[]
  jobs        Job[]
  users       User[]

  @@map("companies")
}

model Job {
  id               String           @id @default(uuid())
  companySlug      String           @map("company_slug")
  title            String
  department       String
  location         String
  type             String
  salary           String?
  applicants       Int              @default(0)
  posted           String?
  postedTimestamp  BigInt?          @map("posted_timestamp")
  status           String           @default("draft")
  description      String?
  fullDescription  String?          @map("full_description")
  responsibilities String[]         @default([])
  requirements     String[]         @default([])
  niceToHave       String[]         @default([]) @map("nice_to_have")
  createdAt        DateTime         @default(now()) @map("created_at")
  updatedAt        DateTime         @updatedAt @map("updated_at")
  applicationForm  ApplicationForm?
  candidates       Candidate[]
  company          Company          @relation(fields: [companySlug], references: [slug], onDelete: Cascade)

  @@index([companySlug])
  @@index([status])
  @@map("jobs")
}

model ApplicationForm {
  id                String   @id @default(uuid())
  jobId             String   @unique @map("job_id")
  standardFields    Json     @default("[]")
  knockoutQuestions Json     @default("[]")
  customQuestions   Json     @default("[]")
  eeoFields         Json     @default("{}")
  createdAt         DateTime @default(now()) @map("created_at")
  updatedAt         DateTime @updatedAt @map("updated_at")
  job               Job      @relation(fields: [jobId], references: [id], onDelete: Cascade)

  @@map("application_forms")
}

model Candidate {
  id                   String                @id @default(uuid())
  companySlug          String                @map("company_slug")
  jobId                String                @map("job_id")
  name                 String
  email                String
  phone                String?
  linkedin             String?
  portfolio            String?
  appliedDate          String                @map("applied_date")
  appliedDateTimestamp BigInt                @map("applied_date_timestamp")
  aiScore              Int                   @default(0) @map("ai_score")
  stage                String                @default("applied")
  jobTitle             String                @map("job_title")
  matchReasons         String[]              @default([]) @map("match_reasons")
  skillMatch           String[]              @default([]) @map("skill_match")
  experience           String?
  currentRole          String?               @map("current_role")
  education            String?
  resumeFile           String?               @map("resume_file")
  coverLetter          String?               @map("cover_letter")
  
  // Analysis Scores (from integration.ts)
  resumeScore          Float?                @map("resume_score")
  questioneryScore     Float?                @map("questionery_score")
  finalScore           Float?                @map("final_score")
  
  // Analysis Data (from integration.ts)
  resumeAnalysisData   String?               @db.Text @map("resume_analysis_data")
  questioneryAnalysisData String?            @db.Text @map("questionery_analysis_data")
  hiringRecommendation String?               @map("hiring_recommendation")
  comprehensiveAnalysis String?              @db.Text @map("comprehensive_analysis")
  overallStrengths     String[]              @default([]) @map("overall_strengths")
  overallWeaknesses    String[]              @default([]) @map("overall_weaknesses")
  recommendations      String[]              @default([]) @map("recommendations")
  
  // Parsed Resume Data (from resume.ts - ParsedResumeData)
  parsedResumeData     Json?                 @map("parsed_resume_data")
  resumeSkills         String[]              @default([]) @map("resume_skills")
  resumeCertifications String[]              @default([]) @map("resume_certifications")
  
  // Analysis Metadata
  analyzedAt           DateTime?             @map("analyzed_at")
  analysisMethod       String?               @map("analysis_method")
  
  createdAt            DateTime              @default(now()) @map("created_at")
  updatedAt            DateTime              @updatedAt @map("updated_at")
  applicationResponses ApplicationResponse[]
  company              Company               @relation(fields: [companySlug], references: [slug], onDelete: Cascade)
  job                  Job                   @relation(fields: [jobId], references: [id], onDelete: Cascade)

  @@index([companySlug])
  @@index([jobId])
  @@index([stage])
  @@index([email])
  @@index([finalScore])
  @@index([analyzedAt])
  @@map("candidates")
}

model ApplicationResponse {
  id          String    @id @default(uuid())
  candidateId String    @map("candidate_id")
  questionId  String    @map("question_id")
  answer      Json
  createdAt   DateTime  @default(now()) @map("created_at")
  candidate   Candidate @relation(fields: [candidateId], references: [id], onDelete: Cascade)

  @@index([candidateId])
  @@index([questionId])
  @@map("application_responses")
}
